<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>State Losses Map</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #fff;
      font-family: Merriweather, Georgia, serif;
    }

    #losses {
      display: grid;
      grid-template-areas:
        "title"
        "toolbar"
        "map"
        "details";
      grid-template-columns: 1fr;
      gap: 12px;
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    #title {
      grid-area: title;
      text-align: center;
      margin: 16px 0 6px;
      font-weight: 700;
    }

    #toolbar {
      grid-area: toolbar;
      display: flex;
      gap: 8px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    #toolbar button {
      cursor: pointer;
      padding: 8px 14px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff;
    }

    #toolbar button:hover {
      background: #f7f7ff;
    }

    #map-panel {
      grid-area: map;
    }

    #losses-map {
      width: 100%;
      aspect-ratio: 16/9;
      min-height: 360px;
      border-radius: 12px;
      overflow: hidden;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    #losses-map:focus {
      outline: none;
      box-shadow: none;
    }

    #details {
      grid-area: details;
      display: none;
      border: 1px solid #eee;
      border-radius: 12px;
      background: #fff;
      padding: 14px 16px;
    }

    #details h3 {
      margin: 0 0 6px;
      font-size: 20px;
    }

    #details p {
      margin: 0 0 6px;
    }

    #sr {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }

    @media (min-width: 980px) {
      #losses {
        grid-template-areas:
          "title title"
          "toolbar toolbar"
          "map details";
        grid-template-columns: 2fr 1fr;
        align-items: start;
      }

      #details {
        margin-left: 4px;
      }
    }
  </style>
</head>
<body>
  <div id="losses" role="region">
    <h2 id="title">State Losses (2025–26)</h2>
    <div id="toolbar">
      <button id="back-btn" style="display:none">← Back</button>
    </div>
    <div id="map-panel">
      <div id="losses-map" tabindex="0"></div>
    </div>
    <div id="details">
      <h3 id="state-name"></h3>
      <p id="state-loss"></p>
      <p>Other data: OTW</p>
    </div>
    <div id="sr" aria-live="polite"></div>
  </div>

  <script>
    (function () {
      const fmt = n => n.toLocaleString('en-US');
      const states = ['Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','District of Columbia','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts','Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada','New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma','Oregon','Pennsylvania','Puerto Rico','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont','Virgin Islands','Virginia','Washington','West Virginia','Wisconsin','Wyoming'];
      const losses = [55032190,1594215,144881731,23189572,1013730821,63824864,122665118,17713793,90425294,243363729,166591360,19689594,11944755,379887657,157360595,42931992,37271876,49024539,41802089,12966497,163581648,619722041,229783788,77048991,13207935,169927376,4534580,18575460,10048901,31326132,148328341,12826367,988805385,144375994,8724437,200264505,37579710,42335765,339979784,2124676,44149974,31757306,8813368,58460749,388453912,46148639,9862807,509519,127438527,144935744,11841709,85455267,3409571];
      const codes = {'Alabama':'AL','Alaska':'AK','Arizona':'AZ','Arkansas':'AR','California':'CA','Colorado':'CO','Connecticut':'CT','Delaware':'DE','District of Columbia':'DC','Florida':'FL','Georgia':'GA','Hawaii':'HI','Idaho':'ID','Illinois':'IL','Indiana':'IN','Iowa':'IA','Kansas':'KS','Kentucky':'KY','Louisiana':'LA','Maine':'ME','Maryland':'MD','Massachusetts':'MA','Michigan':'MI','Minnesota':'MN','Mississippi':'MS','Missouri':'MO','Montana':'MT','Nebraska':'NE','Nevada':'NV','New Hampshire':'NH','New Jersey':'NJ','New Mexico':'NM','New York':'NY','North Carolina':'NC','North Dakota':'ND','Ohio':'OH','Oklahoma':'OK','Oregon':'OR','Pennsylvania':'PA','Puerto Rico':'PR','Rhode Island':'RI','South Carolina':'SC','South Dakota':'SD','Tennessee':'TN','Texas':'TX','Utah':'UT','Vermont':'VT','Virgin Islands':'VI','Virginia':'VA','Washington':'WA','West Virginia':'WV','Wisconsin':'WI','Wyoming':'WY'};

      const mapRows = states.map((n, i) => ({ name: n, code: codes[n], loss: losses[i] })).filter(r => r.code !== 'PR' && r.code !== 'VI');

      const colorScale = [
        [0.0, "#E5DAFF"], [0.1, "#C6B0FD"], [0.2, "#A786FB"],
        [0.35, "#8C62F8"], [0.5, "#7845FA"], [0.65, "#7A45FF"],
        [0.75, "#6E42DE"], [0.85, "#6431E6"], [0.95, "#3D1B91"], [1.0, "#311579"]
      ];

      const traceFull = {
        type: "choropleth",
        locationmode: "USA-states",
        locations: mapRows.map(r => r.code),
        z: mapRows.map(r => r.loss),
        text: mapRows.map(r => r.name),
        hovertemplate: "<b>%{text}</b><br>Losses = $%{z:,}<extra></extra>",
        colorscale: colorScale,
        zmin: Math.min(...mapRows.map(r => r.loss)),
        zmax: Math.max(...mapRows.map(r => r.loss)),
        marker: { line: { color: "#ffffff", width: 1 } },
        showscale: true,
        colorbar: {
          title: "Losses ($)",
          tickprefix: "$",
          tickformat: ",.0f",
          orientation: "h",
          x: 0.5,
          xanchor: "center",
          y: 1.05,
          yanchor: "bottom",
          len: 0.48,
          thickness: 12,
          outlinewidth: 0,
          ticks: "outside"
        }
      };

      const layoutBase = {
        geo: { scope: "usa", projection: { type: "albers usa" } },
        margin: { t: 40, r: 10, b: 10, l: 10 },
        dragmode: false
      };

      const config = {
        responsive: true,
        displayModeBar: true,
        displaylogo: false,
        scrollZoom: false,
        doubleClick: "reset",
        modeBarButtonsToRemove: ["zoom2d", "select2d", "lasso2d", "autoScale2d", "zoomIn2d", "zoomOut2d", "resetScale2d"]
      };

      const mapDiv = document.getElementById('losses-map');
      const backBtn = document.getElementById('back-btn');
      const details = document.getElementById('details');
      const stateNameEl = document.getElementById('state-name');
      const stateLossEl = document.getElementById('state-loss');
      const sr = document.getElementById('sr');

      function drawFull() {
        Plotly.react(mapDiv, [traceFull], layoutBase, config);
        backBtn.style.display = "none";
        details.style.display = "none";
        stateNameEl.textContent = "";
        stateLossEl.textContent = "";
        sr.textContent = "Showing full US map.";
        if (location.hash) history.replaceState(null, '', '#');
      }

      function drawState(code) {
        const r = mapRows.find(r => r.code === code);
        if (!r) return;
        Plotly.react(mapDiv,
          [Object.assign({}, traceFull, {
            locations: [code],
            z: [r.loss],
            showscale: false
          })],
          Object.assign({}, layoutBase, {
            margin: { t: 10, r: 10, b: 10, l: 10 },
            geo: Object.assign({}, layoutBase.geo, { fitbounds: "locations" })
          }),
          config
        );
        stateNameEl.textContent = r.name;
        stateLossEl.textContent = `Projected Losses: $${fmt(r.loss)}`;
        backBtn.style.display = "inline-block";
        details.style.display = "block";
        sr.textContent = `Showing ${r.name}. Projected losses $${fmt(r.loss)}.`;
        if (location.hash !== "#" + code) history.replaceState(null, '', '#' + code);
      }

      Plotly.newPlot(mapDiv, [traceFull], layoutBase, config);
      mapDiv.on('plotly_click', ev => {
        const c = ev.points[0].location;
        drawState(c);
      });
      backBtn.addEventListener('click', () => {
        drawFull();
        mapDiv.focus();
      });
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && backBtn.style.display !== 'none') {
          drawFull();
          mapDiv.focus();
        }
      });
      window.addEventListener('hashchange', () => {
        const c = (location.hash || "").replace('#', '');
        c ? drawState(c) : drawFull();
      });
      if (location.hash) drawState(location.hash.replace('#', ''));
      window.addEventListener('resize', () => {
        Plotly.Plots.resize(mapDiv)
      });
    })();
  </script>
</body>
</html>
